<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRIME BANK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="shortcut icon" href="Logos/bankicon.ico" />
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Share+Tech&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Montserrat:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- –•–µ–¥–µ—Ä -->
    <header id="header">
        <a href="#" class="logo">LY PRIME<span>BANK</span></a>
        <ul class="nav-links">
            <li><a href="#home">HOME</a></li>
            <li><a href="#team">TEAM</a></li>
            <li><a href="#news">INFO</a></li>
            <li><a href="#clubs">CLUBS</a></li>
            <li><a href="/bank/main.html">GO TO BANK</a></li>
            <li><a href="/bank/admin.html">üñã</a></li>
        </ul>
        <!-- –ì–∞–º–±—É—Ä–≥–µ—Ä –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—É -->
        <div class="hamburger">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </header>

    <section class="hero" id="home">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≥–æ–ª–æ–≤–Ω–æ—ó —Å–µ–∫—Ü—ñ—ó -->
        <div class="hero-content">
            <div class="hero-text">
                <br><br><br>
                <h1><span>LYCEUM PRIME</span><span>BANK</span></h1>
                <p>BANK NEWS</p>
                <div class="hero-btns">
                    <a href="#news" class="btn btn-primaryI">INFORMATION</a>
                    <a href="#team" class="btn btn-secondary">TEAM</a>
                </div>
            </div>
            <div class="hero-image">
                <img src="Logos/card.png" alt="HOT">
                <div class="social-links"></div>
            </div>
        </div>
    </section>
    <div class="line"></div>
    <section class="section" id="team">
        <div class="section-title">
            <h2>TEAM</h2>
        </div>
        <div class="services-grid">
            <div class="service-card">
                <img src="Logos/image.jpg" alt="">
                <h3>PRIMES</h3>
            </div>
        </div>
    </section>
    <div class="line"></div>
    <section class="section" id="news">
        <div class="section-title">
            <h2>INFORMATION</h2>
        </div>
        <div class="newsBox" id="newsContainer"></div>
        <div id="pagination" class="pagination"></div>
        <div id="newsModal" class="modal">
            <div class="modal-content">
                <div class="modal-img" id="modalMedia"></div>
                <div class="modal-text">
                    <h2 id="modalTitle"></h2>
                    <p id="modalText"></p>
                </div>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
        </div>
    </section>
    <div class="line"></div>
    <section class="section" id="clubs">
        <div class="section-title">
            <h2>CLUBS</h2>
        </div>
        <div class="clubs-grid" id="clubsContainer"></div>
        <div id="clubModal" class="club-modal">
            <div class="club-modal-content">
                <span class="close-club" onclick="closeClubModal()">&times;</span>
                <img id="clubModalImage" src="" alt="Club Leader">
                <h2 id="clubModalLeaderName"></h2>
                <p id="clubModalDescription"></p>
                <a id="clubModalGoogleForm" href="#" class="btn btn-primary" target="_blank">Join Club</a>
            </div>
        </div>
    </section>
    <div class="line"></div>
    <section class="section" id="static">
        <div class="section-title">
            <h2>STATISTICS</h2>
        </div>
        <div class="stats-container" id="statsContainer">
            <div class="stat-card">
                <h3 id="userCount">0</h3>
                <p>Registered Users</p>
            </div>
        </div>
    </section>
    <div class="line"></div>

    <footer>
        <div class="footer-content">
            <a href="#" class="footer-logo">PRIME<span>BANK</span></a>
            <ul class="footer-links">
                <li><a href="#home">HOME</a></li>
                <li><a href="#team">TEAM</a></li>
                <li><a href="#news">INFO</a></li>
                <li><a href="#clubs">CLUBS</a></li>
                
            </ul>
            <div class="footer-social"></div>
            <p class="copyright">¬©2025 PRIME BANK</p>
        </div>
    </footer>
    <div class="line"></div>
    <div class="scroll-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <script type="module">
        // –Ü–º–ø–æ—Ä—Ç–∏ Firebase
        import { db } from "./Scripts/firebase.js";
        import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

        const container = document.getElementById("newsContainer");
        const pagination = document.createElement("div");
        pagination.id = "pagination";
        pagination.className = "pagination";
        container.after(pagination);

        let newsList = [];
        let currentPage = 1;
        const perPage = 5;

        async function loadNews() {
            container.innerHTML = "";
            const q = query(collection(db, "news"), orderBy("timestamp", "desc"));
            try {
                const snapshot = await getDocs(q);
                newsList = [];
                snapshot.forEach(docSnap => {
                    newsList.push(docSnap.data());
                });
                renderPage(currentPage);
                renderPagination();
            } catch (error) {
                console.error("Error loading news:", error);
                container.innerHTML = `<p style="text-align: center; color: red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–∏–Ω.</p>`;
            }
        }

        function isYouTubeUrl(url) {
            return url && (url.includes('youtube.com') || url.includes('youtu.be'));
        }

        function getYouTubeEmbedUrl(url) {
            let id;
            if (url.includes('watch?v=')) {
                id = url.split('watch?v=')[1].split('&')[0];
            } else if (url.includes('youtu.be/')) {
                id = url.split('youtu.be/')[1].split('?')[0];
            }
            return `https://www.youtube.com/embed/${id}`;
        }

        function linkify(text) {
            const normalizedText = text.trim().replace(/\r\n/g, '\n').replace(/\n{2,}/g, '\n\n');
            const paragraphs = normalizedText.split('\n\n').map(paragraph => {
                const formattedParagraph = paragraph.replace(/\n/g, '<br>');
                return formattedParagraph.trim() ? `<p>${formattedParagraph}</p>` : '';
            }).filter(p => p).join('');
            const urlPattern = /(https?:\/\/[^\s<]+)/g;
            return paragraphs.replace(urlPattern, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
        }

        function renderPage(page) {
            container.innerHTML = "";
            const start = (page - 1) * perPage;
            const end = start + perPage;
            const items = newsList.slice(start, end);

            if (items.length === 0) {
                container.innerHTML = `<p style="text-align: center;">–ù–æ–≤–∏–Ω –ø–æ–∫–∏ –Ω–µ–º–∞—î.</p>`;
                return;
            }

            items.forEach(news => {
                let dateStr = "";
                if (news.timestamp && news.timestamp.toDate) {
                    const date = news.timestamp.toDate();
                    dateStr = date.toLocaleString("uk-UA", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                        hour: "2-digit",
                        minute: "2-digit"
                    });
                }

                let mediaHtml = '';
                if (isYouTubeUrl(news.image)) {
                    mediaHtml = `<iframe src="${getYouTubeEmbedUrl(news.image)}" frameborder="0" allowfullscreen style="width:100%; height:100%;"></iframe>`;
                } else {
                    mediaHtml = `<img src="${news.image || 'https://picsum.photos/400/250'}" alt="news" style="width:100%; height:100%; object-fit:cover;">`;
                }

                const div = document.createElement("div");
                div.className = "new";
                div.onclick = () => openModal(news);

                div.innerHTML = `
                <div class="news-img">
                    ${mediaHtml}
                    <div class="news-title-overlay">${news.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫—É'}</div>
                </div>
                <div class="news-content">
                    <h3 class="news-title">${news.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫—É'}</h3>
                    <p class="news-desc">${news.description || '–ë–µ–∑ –æ–ø–∏—Å—É'}</p>
                </div>
            `;
                container.appendChild(div);
            });
        }

        function renderPagination() {
            pagination.innerHTML = "";
            const totalPages = Math.ceil(newsList.length / perPage);
            if (totalPages <= 1) return;

            if (currentPage > 1) {
                const prev = document.createElement("button");
                prev.textContent = "‚Üê";
                prev.onclick = () => {
                    currentPage--;
                    renderPage(currentPage);
                    renderPagination();
                };
                pagination.appendChild(prev);
            }

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement("button");
                btn.textContent = i;
                if (i === currentPage) btn.disabled = true;
                btn.onclick = () => {
                    currentPage = i;
                    renderPage(currentPage);
                    renderPagination();
                };
                pagination.appendChild(btn);
            }

            if (currentPage < totalPages) {
                const next = document.createElement("button");
                next.textContent = "‚Üí";
                next.onclick = () => {
                    currentPage++;
                    renderPage(currentPage);
                    renderPagination();
                };
                pagination.appendChild(next);
            }
        }

        function openModal(news) {
            document.getElementById("modalTitle").innerText = news.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫—É';
            document.getElementById("modalText").innerHTML = DOMPurify.sanitize(linkify(news.fullText || '–ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç –≤—ñ–¥—Å—É—Ç–Ω—ñ–π'));

            const mediaElem = document.getElementById("modalMedia");
            mediaElem.innerHTML = "";

            if (isYouTubeUrl(news.image)) {
                const iframe = document.createElement('iframe');
                iframe.src = getYouTubeEmbedUrl(news.image);
                iframe.width = '100%';
                iframe.height = '300';
                iframe.frameBorder = '0';
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                iframe.allowFullscreen = true;
                mediaElem.appendChild(iframe);
            } else {
                const img = document.createElement('img');
                img.src = news.image || 'https://picsum.photos/400/250';
                img.alt = 'news';
                img.style.width = '100%';
                img.style.height = 'auto';
                img.style.maxHeight = '400px';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '10px';
                mediaElem.appendChild(img);
            }

            document.getElementById("newsModal").style.display = "block";
        }

        window.closeModal = function () {
            document.getElementById("newsModal").style.display = "none";
        };

        const clubsContainer = document.getElementById('clubsContainer');

        async function loadClubs() {
            clubsContainer.innerHTML = "";
            try {
                const snapshot = await getDocs(collection(db, "clubs"));
                const clubs = [];
                snapshot.forEach(docSnap => {
                    clubs.push(docSnap.data());
                });

                if (clubs.length === 0) {
                    clubsContainer.innerHTML = `<p style="text-align: center;">–ö–ª—É–±—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î.</p>`;
                    return;
                }

                clubs.forEach(club => {
                    const div = document.createElement("div");
                    div.className = "club-card";
                    div.innerHTML = `
                    <img src="${club.image || 'https://picsum.photos/400/250'}" alt="${club.name || 'Club'}">
                    <div class="club-content">
                        <h3>${club.name || '–ë–µ–∑ –æ–ø–∏—Å—É'}</h3>
                        <p>${club.description || '–ë–µ–∑ –æ–ø–∏—Å—É'}</p>
                        <button class="btn btn-secondary" onclick='openClubModal(${JSON.stringify({
                        image2: club.image2 || 'https://picsum.photos/400/250',
                        leaderName: club.leaderName || 'No name',
                        description: club.description || 'No description',
                        googleForm: club.googleForm || '#'
                    })})'>Open</button>
                    </div>
                `;
                    clubsContainer.appendChild(div);
                });
            } catch (error) {
                console.error("Error loading clubs:", error);
                clubsContainer.innerHTML = `<p style="text-align: center; color: red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª—É–±—ñ–≤.</p>`;
            }
        }

        window.openClubModal = function (club) {
            document.getElementById("clubModalImage").src = club.image2;
            document.getElementById("clubModalLeaderName").innerText = club.leaderName;
            document.getElementById("clubModalDescription").innerText = club.description;
            document.getElementById("clubModalGoogleForm").href = club.googleForm;
            document.getElementById("clubModal").style.display = "block";
        };

        window.closeClubModal = function () {
            document.getElementById("clubModal").style.display = "none";
        };

        const plansContainer = document.getElementById('plansContainer');

        async function loadPlans() {
            plansContainer.innerHTML = "";
            try {
                const snapshot = await getDocs(collection(db, "plans"));
                const plans = [];
                snapshot.forEach(docSnap => {
                    plans.push(docSnap.data());
                });

                if (plans.length === 0) {
                    plansContainer.innerHTML = `<p style="text-align: center;">Coming soon.</p>`;
                    return;
                }

                plans.forEach(plan => {
                    const progress = plan.progress ?? 0;
                    const div = document.createElement("div");
                    div.className = "plan-item";
                    div.innerHTML = `
                    <h3>${plan.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞'}</h3>
                    <div class="skill-bar">
                        <div class="skill-progress" style="width: ${progress}%;"></div>
                    </div>
                    <p>${progress}% –≤–∏–∫–æ–Ω–∞–Ω–æ</p>
                `;
                    plansContainer.appendChild(div);
                });
            } catch (error) {
                console.error("Error loading plans:", error);
                plansContainer.innerHTML = `<p style="text-align: center; color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–Ω–æ–≤.</p>`;
            }
        }

        async function loadUserStats() {
            const statsContainer = document.getElementById('statsContainer');
            try {
                const usersSnapshot = await getDocs(collection(db, "users"));
                const userCount = usersSnapshot.size;
                document.getElementById('userCount').innerText = userCount;
            } catch (error) {
                console.error("Error loading user stats:", error);
                statsContainer.innerHTML = `<p style="text-align: center; color: red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadNews();
            loadClubs();
            loadPlans();
            loadUserStats();

            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');
            const links = document.querySelectorAll('.nav-links li');

            hamburger.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                hamburger.classList.toggle('active');
                links.forEach((link, index) => {
                    if (link.style.animation) {
                        link.style.animation = '';
                    } else {
                        link.style.animation = `navLinkFade 0.5s ease forwards ${index / 7 + 0.3}s`;
                    }
                });
            });

            links.forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    hamburger.classList.remove('active');
                    links.forEach(link => {
                        link.style.animation = '';
                    });
                });
            });

            const scrollTop = document.querySelector('.scroll-top');
            window.addEventListener('scroll', () => {
                const header = document.getElementById('header');
                if (window.scrollY > 100) {
                    header.classList.add('scrolled');
                    scrollTop.classList.add('active');
                } else {
                    header.classList.remove('scrolled');
                    scrollTop.classList.remove('active');
                }
            });

            scrollTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>

</html>